<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–Ω–∞–∂–µ—Ä —Å–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–±–µ–π</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 1100px;
            width: 100%;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            padding: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #3498db, #9b59b6, #2ecc71);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin: 0 0 20px 0;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .stat-item {
            text-align: center;
            padding: 0 10px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #3498db;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 13px;
            color: #7f8c8d;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .task-container {
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .task-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .equation-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .fraction {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .fraction-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
        }
        
        .fraction-numerator, .fraction-denominator {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .fraction-line {
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #3498db, #9b59b6);
            margin: 8px 0;
            border-radius: 2px;
        }
        
        .multiplier-input, .result-input, .sum-input, .simplified-input {
            width: 65px;
            height: 50px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 28px;
            text-align: center;
            font-weight: 700;
            transition: all 0.3s;
            background: #f8f9fa;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .multiplier-input:focus, .result-input:focus, .sum-input:focus, .simplified-input:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .multiplier-sign, .equals-sign, .plus-sign {
            font-size: 24px;
            color: #7f8c8d;
            font-weight: bold;
        }
        
        .sum-section, .simplified-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .sum-inputs, .simplified-inputs {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .sum-line, .simplified-line {
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, #2ecc71, #27ae60);
            margin: 5px 0;
            border-radius: 2px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        
        .check-btn {
            background: linear-gradient(to right, #2ecc71, #27ae60);
            color: white;
        }
        
        .next-btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
        }
        
        .solution-container {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(to bottom, #fef9e7, #fef5e7);
            border-radius: 12px;
            border-left: 5px solid #f39c12;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .solution-title {
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            font-size: 18px;
        }
        
        .feedback-container {
            text-align: center;
            margin: 20px 0;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .feedback-message {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .emoji {
            font-size: 42px;
            animation: bounce 0.5s;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-12px);}
            60% {transform: translateY(-6px);}
        }
        
        .charts-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .chart-group {
            margin-bottom: 10px;
        }
        
        .chart-wrapper {
            margin-bottom: 5px;
        }
        
        .chart-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        
        .fraction-text {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .common-fraction-text {
            font-size: 16px;
            font-weight: bold;
            color: #9b59b6;
        }
        
        .sum-fraction-text {
            font-size: 16px;
            font-weight: bold;
            color: #27ae60;
        }
        
        .simplified-fraction-text {
            font-size: 16px;
            font-weight: bold;
            color: #e67e22;
        }
        
        .chart {
            display: flex;
            height: 40px;
            border: 2px solid #2c3e50;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .segment {
            flex: 1;
            position: relative;
            transition: all 0.3s ease;
        }
        
        /* –ß–µ—Ç–∫–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ */
        .segment:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #2c3e50;
            z-index: 2;
        }
        
        .fraction-1 .filled {
            background: linear-gradient(to right, #3498db, #2980b9);
        }
        
        .fraction-2 .filled {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }
        
        .sum-fraction .filled {
            background: linear-gradient(to right, #2ecc71, #27ae60);
        }
        
        .simplified-fraction .filled {
            background: linear-gradient(to right, #e67e22, #d35400);
        }
        
        .empty {
            background: linear-gradient(to bottom, #f8f9fa, #e9ecef);
        }
        
        .common-denominator-section, .simplified-section-solution {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #9b59b6;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .simplified-section-solution {
            border-left: 4px solid #e67e22;
            margin-top: 10px;
        }
        
        .common-denominator-section h3, .simplified-section-solution h3 {
            color: #9b59b6;
            margin: 0;
            font-size: 1rem;
        }
        
        .simplified-section-solution h3 {
            color: #e67e22;
        }
        
        .progress-container {
            width: 100%;
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 6px;
            margin-top: 15px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #2ecc71, #27ae60);
            width: 0%;
            transition: width 0.5s;
            border-radius: 6px;
        }
        
        .level-indicator {
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            color: #7f8c8d;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }
        
        .multiplier-explanation, .simplified-explanation {
            text-align: center;
            margin: 15px 0;
            color: #7f8c8d;
            font-size: 14px;
            font-style: italic;
        }
        
        /* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫–∏ —É –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¢—Ä–µ–Ω–∞–∂–µ—Ä —Å–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–±–µ–π</h1>
        
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-value" id="correctCount">0</div>
                <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="incorrectCount">0</div>
                <div class="stat-label">–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="successRate">0%</div>
                <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="streakCount">0</div>
                <div class="stat-label">–°–µ—Ä–∏—è</div>
            </div>
        </div>
        
        <div class="task-container">
            <div class="task-title">–°–ª–æ–∂–∏—Ç–µ –¥—Ä–æ–±–∏, –ø—Ä–∏–≤–µ–¥—è –∏—Ö –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é:</div>
            
            <div class="equation-container">
                <div class="fraction">
                    <div class="fraction-row">
                        <div class="fraction-numerator" id="taskNumerator1">3</div>
                        <span class="multiplier-sign">√ó</span>
                        <input type="number" id="multiplier1Numerator" class="multiplier-input" min="1" max="20" placeholder="?">
                        <span class="equals-sign">=</span>
                        <input type="number" id="result1Numerator" class="result-input" min="1" max="100" placeholder="?">
                    </div>
                    <div class="fraction-line"></div>
                    <div class="fraction-row">
                        <div class="fraction-denominator" id="taskDenominator1">5</div>
                        <span class="multiplier-sign">√ó</span>
                        <input type="number" id="multiplier1Denominator" class="multiplier-input" min="1" max="20" placeholder="?">
                        <span class="equals-sign">=</span>
                        <input type="number" id="result1Denominator" class="result-input" min="1" max="100" placeholder="?">
                    </div>
                </div>
                
                <span class="plus-sign">+</span>
                
                <div class="fraction">
                    <div class="fraction-row">
                        <div class="fraction-numerator" id="taskNumerator2">2</div>
                        <span class="multiplier-sign">√ó</span>
                        <input type="number" id="multiplier2Numerator" class="multiplier-input" min="1" max="20" placeholder="?">
                        <span class="equals-sign">=</span>
                        <input type="number" id="result2Numerator" class="result-input" min="1" max="100" placeholder="?">
                    </div>
                    <div class="fraction-line"></div>
                    <div class="fraction-row">
                        <div class="fraction-denominator" id="taskDenominator2">3</div>
                        <span class="multiplier-sign">√ó</span>
                        <input type="number" id="multiplier2Denominator" class="multiplier-input" min="1" max="20" placeholder="?">
                        <span class="equals-sign">=</span>
                        <input type="number" id="result2Denominator" class="result-input" min="1" max="100" placeholder="?">
                    </div>
                </div>
                
                <span class="equals-sign">=</span>
                
                <div class="sum-section">
                    <div class="sum-inputs">
                        <input type="number" id="sumNumerator" class="sum-input" min="1" max="200" placeholder="?">
                        <div class="sum-line"></div>
                        <input type="number" id="sumDenominator" class="sum-input" min="1" max="100" placeholder="?">
                    </div>
                </div>

                <span class="equals-sign" id="simplifiedEquals" style="display: none;">=</span>
                
                <div class="simplified-section" id="simplifiedSection" style="display: none;">
                    <div class="simplified-inputs">
                        <input type="number" id="simplifiedNumerator" class="simplified-input" min="1" max="200" placeholder="?">
                        <div class="simplified-line"></div>
                        <input type="number" id="simplifiedDenominator" class="simplified-input" min="1" max="100" placeholder="?">
                    </div>
                </div>
            </div>
            
            <div class="multiplier-explanation">
                –í–≤–µ–¥–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–º–Ω–æ–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –¥—Ä–æ–±–µ–π –∫ –æ–±—â–µ–º—É –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é, –∑–∞—Ç–µ–º –≤–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–æ–∂–µ–Ω–∏—è
            </div>
            
            <div class="simplified-explanation" id="simplifiedExplanation" style="display: none;">
                –ï—Å–ª–∏ –¥—Ä–æ–±—å –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—É—é –¥—Ä–æ–±—å
            </div>
            
            <div class="feedback-container" id="feedbackContainer">
                <div class="feedback-message" id="feedbackMessage">–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"</div>
                <div class="emoji" id="feedbackEmoji"></div>
            </div>
            
            <div class="controls">
                <button class="check-btn" id="checkButton">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="next-btn" id="nextButton" style="display: none;">–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ</button>
            </div>
        </div>
        
        <div class="solution-container" id="solutionContainer">
            <div class="solution-title">–†–µ—à–µ–Ω–∏–µ:</div>
            <div class="common-denominator-section">
                <h3>–û–±—â–∏–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å: <span id="commonDenominatorValue">15</span></h3>
            </div>
            <div class="sum-fraction-text" id="sumFractionText"></div>
            <div class="simplified-section-solution" id="simplifiedSolutionSection" style="display: none;">
                <h3>–°–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è –¥—Ä–æ–±—å: <span id="simplifiedFractionValue"></span></h3>
            </div>
            <div class="charts-container">
                <div class="chart-group">
                    <div class="chart-wrapper fraction-1">
                        <div class="chart-label">
                            <span>–î—Ä–æ–±—å 1:</span>
                            <span class="fraction-text" id="fractionText1">3/5</span>
                        </div>
                        <div class="chart" id="chart1"></div>
                    </div>
                    
                    <div class="chart-wrapper fraction-1">
                        <div class="chart-label">
                            <span>–° –æ–±—â–∏–º –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–º:</span>
                            <span class="common-fraction-text" id="commonFractionText1">9/15</span>
                        </div>
                        <div class="chart" id="commonChart1"></div>
                    </div>
                </div>
                
                <div class="chart-group">
                    <div class="chart-wrapper fraction-2">
                        <div class="chart-label">
                            <span>–î—Ä–æ–±—å 2:</span>
                            <span class="fraction-text" id="fractionText2">2/3</span>
                        </div>
                        <div class="chart" id="chart2"></div>
                    </div>
                    
                    <div class="chart-wrapper fraction-2">
                        <div class="chart-label">
                            <span>–° –æ–±—â–∏–º –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ–º:</span>
                            <span class="common-fraction-text" id="commonFractionText2">10/15</span>
                        </div>
                        <div class="chart" id="commonChart2"></div>
                    </div>
                </div>
                
                <div class="chart-group">
                    <div class="chart-wrapper sum-fraction">
                        <div class="chart-label">
                            <span>–°—É–º–º–∞:</span>
                            <span class="sum-fraction-text" id="sumFractionResult">19/15</span>
                        </div>
                        <div class="chart" id="sumChart"></div>
                    </div>
                </div>

                <div class="chart-group" id="simplifiedChartGroup" style="display: none;">
                    <div class="chart-wrapper simplified-fraction">
                        <div class="chart-label">
                            <span>–°–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è –¥—Ä–æ–±—å:</span>
                            <span class="simplified-fraction-text" id="simplifiedFractionResult"></span>
                        </div>
                        <div class="chart" id="simplifiedChart"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="level-indicator" id="levelIndicator">–£—Ä–æ–≤–µ–Ω—å: –ù–æ–≤–∏—á–æ–∫</div>
    </div>

    <script>
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–µ–Ω–∏–∫–∞
        const stats = {
            correct: 0,
            incorrect: 0,
            streak: 0,
            bestStreak: 0,
            total: 0
        };
        
        // –¢–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ
        let currentTask = {
            numerator1: 0,
            denominator1: 0,
            numerator2: 0,
            denominator2: 0,
            commonDenominator: 0,
            multiplier1: 0,
            multiplier2: 0,
            result1Numerator: 0,
            result1Denominator: 0,
            result2Numerator: 0,
            result2Denominator: 0,
            sumNumerator: 0,
            sumDenominator: 0,
            simplifiedNumerator: 0,
            simplifiedDenominator: 0,
            canBeSimplified: false
        };
        
        // –≠–º–æ–¥–∑–∏ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
        const emojis = {
            success: ['üèÜ', 'üéâ', '‚≠ê', 'üëë', 'üí™'],
            encouragement: ['üí™', 'üî•', 'üöÄ', 'üëç', 'üòä'],
            failure: ['üòî', 'ü§î', 'üí°', 'üìö', 'üîç']
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ù–û–î (–Ω–∞–∏–±–æ–ª—å—à–µ–≥–æ –æ–±—â–µ–≥–æ –¥–µ–ª–∏—Ç–µ–ª—è)
        function gcd(a, b) {
            return b ? gcd(b, a % b) : a;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ù–û–ö (–Ω–∞–∏–º–µ–Ω—å—à–µ–≥–æ –æ–±—â–µ–≥–æ –∫—Ä–∞—Ç–Ω–æ–≥–æ)
        function lcm(a, b) {
            return Math.abs(a * b) / gcd(a, b);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è –¥—Ä–æ–±–∏
        function simplifyFraction(numerator, denominator) {
            const divisor = gcd(numerator, denominator);
            return {
                numerator: numerator / divisor,
                denominator: denominator / divisor,
                canBeSimplified: divisor > 1
            };
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
        function generateTask() {
            let denominator1, denominator2;
            let commonDenominator;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–∏ —Å –ù–û–ö <= 100
            do {
                denominator1 = Math.floor(Math.random() * 10) + 2; // –æ—Ç 2 –¥–æ 11
                denominator2 = Math.floor(Math.random() * 10) + 2; // –æ—Ç 2 –¥–æ 11
                // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–∏ —Ä–∞–∑–Ω—ã–µ
                if (denominator1 === denominator2) {
                    denominator2 = Math.floor(Math.random() * 10) + 2;
                }
                commonDenominator = lcm(denominator1, denominator2);
            } while (commonDenominator > 100 || denominator1 === denominator2);
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∏—Å–ª–∏—Ç–µ–ª–∏
            const numerator1 = Math.floor(Math.random() * (denominator1 - 1)) + 1;
            const numerator2 = Math.floor(Math.random() * (denominator2 - 1)) + 1;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª–∏
            const multiplier1 = commonDenominator / denominator1;
            const multiplier2 = commonDenominator / denominator2;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–º–Ω–æ–∂–µ–Ω–∏—è
            const result1Numerator = numerator1 * multiplier1;
            const result1Denominator = denominator1 * multiplier1;
            const result2Numerator = numerator2 * multiplier2;
            const result2Denominator = denominator2 * multiplier2;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º—É
            const sumNumerator = result1Numerator + result2Numerator;
            const sumDenominator = commonDenominator;
            
            // –°–æ–∫—Ä–∞—â–∞–µ–º –¥—Ä–æ–±—å
            const simplified = simplifyFraction(sumNumerator, sumDenominator);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–¥–∞–Ω–∏–µ
            currentTask = {
                numerator1,
                denominator1,
                numerator2,
                denominator2,
                commonDenominator,
                multiplier1,
                multiplier2,
                result1Numerator,
                result1Denominator,
                result2Numerator,
                result2Denominator,
                sumNumerator,
                sumDenominator,
                simplifiedNumerator: simplified.numerator,
                simplifiedDenominator: simplified.denominator,
                canBeSimplified: simplified.canBeSimplified
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è
            document.getElementById('taskNumerator1').textContent = numerator1;
            document.getElementById('taskDenominator1').textContent = denominator1;
            document.getElementById('taskNumerator2').textContent = numerator2;
            document.getElementById('taskDenominator2').textContent = denominator2;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('multiplier1Numerator').value = '';
            document.getElementById('multiplier1Denominator').value = '';
            document.getElementById('multiplier2Numerator').value = '';
            document.getElementById('multiplier2Denominator').value = '';
            document.getElementById('result1Numerator').value = '';
            document.getElementById('result1Denominator').value = '';
            document.getElementById('result2Numerator').value = '';
            document.getElementById('result2Denominator').value = '';
            document.getElementById('sumNumerator').value = '';
            document.getElementById('sumDenominator').value = '';
            document.getElementById('simplifiedNumerator').value = '';
            document.getElementById('simplifiedDenominator').value = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–π –¥—Ä–æ–±–∏
            if (currentTask.canBeSimplified) {
                document.getElementById('simplifiedSection').style.display = 'flex';
                document.getElementById('simplifiedEquals').style.display = 'block';
                document.getElementById('simplifiedExplanation').style.display = 'block';
            } else {
                document.getElementById('simplifiedSection').style.display = 'none';
                document.getElementById('simplifiedEquals').style.display = 'none';
                document.getElementById('simplifiedExplanation').style.display = 'none';
            }
            
            document.getElementById('feedbackMessage').textContent = '–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"';
            document.getElementById('feedbackMessage').style.color = '#2c3e50';
            document.getElementById('feedbackEmoji').textContent = '';
            document.getElementById('checkButton').style.display = 'block';
            document.getElementById('nextButton').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞, —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ
            document.getElementById('solutionContainer').style.display = 'none';
            document.querySelector('.task-title').classList.remove('hidden');
            document.querySelector('.multiplier-explanation').classList.remove('hidden');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
        function checkAnswer() {
            const userMultiplier1Numerator = parseInt(document.getElementById('multiplier1Numerator').value);
            const userMultiplier1Denominator = parseInt(document.getElementById('multiplier1Denominator').value);
            const userMultiplier2Numerator = parseInt(document.getElementById('multiplier2Numerator').value);
            const userMultiplier2Denominator = parseInt(document.getElementById('multiplier2Denominator').value);
            
            const userResult1Numerator = parseInt(document.getElementById('result1Numerator').value);
            const userResult1Denominator = parseInt(document.getElementById('result1Denominator').value);
            const userResult2Numerator = parseInt(document.getElementById('result2Numerator').value);
            const userResult2Denominator = parseInt(document.getElementById('result2Denominator').value);
            
            const userSumNumerator = parseInt(document.getElementById('sumNumerator').value);
            const userSumDenominator = parseInt(document.getElementById('sumDenominator').value);
            
            const userSimplifiedNumerator = parseInt(document.getElementById('simplifiedNumerator').value);
            const userSimplifiedDenominator = parseInt(document.getElementById('simplifiedDenominator').value);
            
            if (isNaN(userMultiplier1Numerator) || isNaN(userMultiplier1Denominator) ||
                isNaN(userMultiplier2Numerator) || isNaN(userMultiplier2Denominator) ||
                isNaN(userResult1Numerator) || isNaN(userResult1Denominator) ||
                isNaN(userResult2Numerator) || isNaN(userResult2Denominator) ||
                isNaN(userSumNumerator) || isNaN(userSumDenominator)) {
                document.getElementById('feedbackMessage').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                document.getElementById('feedbackMessage').style.color = '#e74c3c';
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª–∏
            const isMultiplier1Correct = userMultiplier1Numerator === currentTask.multiplier1 && 
                                        userMultiplier1Denominator === currentTask.multiplier1;
            const isMultiplier2Correct = userMultiplier2Numerator === currentTask.multiplier2 && 
                                        userMultiplier2Denominator === currentTask.multiplier2;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–º–Ω–æ–∂–µ–Ω–∏—è
            const isResult1Correct = userResult1Numerator === currentTask.result1Numerator && 
                                    userResult1Denominator === currentTask.result1Denominator;
            const isResult2Correct = userResult2Numerator === currentTask.result2Numerator && 
                                    userResult2Denominator === currentTask.result2Denominator;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É
            const isSumCorrect = userSumNumerator === currentTask.sumNumerator && 
                                userSumDenominator === currentTask.sumDenominator;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—É—é –¥—Ä–æ–±—å, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
            let isSimplifiedCorrect = true;
            if (currentTask.canBeSimplified) {
                if (isNaN(userSimplifiedNumerator) || isNaN(userSimplifiedDenominator)) {
                    document.getElementById('feedbackMessage').textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—É—é –¥—Ä–æ–±—å';
                    document.getElementById('feedbackMessage').style.color = '#e74c3c';
                    return;
                }
                isSimplifiedCorrect = userSimplifiedNumerator === currentTask.simplifiedNumerator && 
                                     userSimplifiedDenominator === currentTask.simplifiedDenominator;
            } else {
                // –ï—Å–ª–∏ –¥—Ä–æ–±—å –Ω–µ–ª—å–∑—è —Å–æ–∫—Ä–∞—Ç–∏—Ç—å, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ –≤–≤–µ–ª, —ç—Ç–æ –æ—à–∏–±–∫–∞
                if (!isNaN(userSimplifiedNumerator) || !isNaN(userSimplifiedDenominator)) {
                    isSimplifiedCorrect = false;
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ
            document.querySelector('.task-title').classList.add('hidden');
            document.querySelector('.multiplier-explanation').classList.add('hidden');
            document.getElementById('solutionContainer').style.display = 'block';
            
            if (isMultiplier1Correct && isMultiplier2Correct && isResult1Correct && isResult2Correct && isSumCorrect && isSimplifiedCorrect) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                handleCorrectAnswer();
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                handleIncorrectAnswer();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏
            showSolution();
            
            // –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ"
            document.getElementById('checkButton').style.display = 'none';
            document.getElementById('nextButton').style.display = 'block';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        function handleCorrectAnswer() {
            stats.correct++;
            stats.streak++;
            stats.total++;
            
            if (stats.streak > stats.bestStreak) {
                stats.bestStreak = stats.streak;
            }
            
            updateStats();
            
            // –°–ª—É—á–∞–π–Ω—ã–π —ç–º–æ–¥–∑–∏ –¥–ª—è —É—Å–ø–µ—Ö–∞
            const randomEmoji = emojis.success[Math.floor(Math.random() * emojis.success.length)];
            document.getElementById('feedbackMessage').textContent = getSuccessMessage();
            document.getElementById('feedbackMessage').style.color = '#27ae60';
            document.getElementById('feedbackEmoji').textContent = randomEmoji;
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        function handleIncorrectAnswer() {
            stats.incorrect++;
            stats.streak = 0;
            stats.total++;
            updateStats();
            
            document.getElementById('feedbackMessage').textContent = '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ!';
            document.getElementById('feedbackMessage').style.color = '#e74c3c';
            document.getElementById('feedbackEmoji').textContent = 'üí°';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ —Å –¥–∏–∞–≥—Ä–∞–º–º–∞–º–∏
        function showSolution() {
            const {
                numerator1,
                denominator1,
                numerator2,
                denominator2,
                commonDenominator,
                multiplier1,
                multiplier2,
                result1Numerator,
                result1Denominator,
                result2Numerator,
                result2Denominator,
                sumNumerator,
                sumDenominator,
                simplifiedNumerator,
                simplifiedDenominator,
                canBeSimplified
            } = currentTask;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥—Ä–æ–±–µ–π
            document.getElementById('fractionText1').textContent = `${numerator1}/${denominator1}`;
            document.getElementById('fractionText2').textContent = `${numerator2}/${denominator2}`;
            document.getElementById('commonFractionText1').textContent = `${result1Numerator}/${result1Denominator}`;
            document.getElementById('commonFractionText2').textContent = `${result2Numerator}/${result2Denominator}`;
            document.getElementById('commonDenominatorValue').textContent = commonDenominator;
            document.getElementById('sumFractionText').textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${sumNumerator}/${sumDenominator}`;
            document.getElementById('sumFractionResult').textContent = `${sumNumerator}/${sumDenominator}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ —Å —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–π –¥—Ä–æ–±—å—é
            if (canBeSimplified) {
                document.getElementById('simplifiedSolutionSection').style.display = 'block';
                document.getElementById('simplifiedFractionValue').textContent = `${simplifiedNumerator}/${simplifiedDenominator}`;
                document.getElementById('simplifiedFractionResult').textContent = `${simplifiedNumerator}/${simplifiedDenominator}`;
                document.getElementById('simplifiedChartGroup').style.display = 'block';
            } else {
                document.getElementById('simplifiedSolutionSection').style.display = 'none';
                document.getElementById('simplifiedChartGroup').style.display = 'none';
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º
            drawFractionChart(numerator1, denominator1, 'chart1');
            drawFractionChart(numerator2, denominator2, 'chart2');
            drawFractionChart(result1Numerator, result1Denominator, 'commonChart1');
            drawFractionChart(result2Numerator, result2Denominator, 'commonChart2');
            drawFractionChart(sumNumerator, sumDenominator, 'sumChart');
            
            if (canBeSimplified) {
                drawFractionChart(simplifiedNumerator, simplifiedDenominator, 'simplifiedChart');
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
            document.getElementById('multiplier1Numerator').value = multiplier1;
            document.getElementById('multiplier1Denominator').value = multiplier1;
            document.getElementById('multiplier2Numerator').value = multiplier2;
            document.getElementById('multiplier2Denominator').value = multiplier2;
            document.getElementById('result1Numerator').value = result1Numerator;
            document.getElementById('result1Denominator').value = result1Denominator;
            document.getElementById('result2Numerator').value = result2Numerator;
            document.getElementById('result2Denominator').value = result2Denominator;
            document.getElementById('sumNumerator').value = sumNumerator;
            document.getElementById('sumDenominator').value = sumDenominator;
            
            if (canBeSimplified) {
                document.getElementById('simplifiedNumerator').value = simplifiedNumerator;
                document.getElementById('simplifiedDenominator').value = simplifiedDenominator;
            }
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–∏–∞–≥—Ä–∞–º–º—ã
        function drawFractionChart(numerator, denominator, chartId) {
            const chart = document.getElementById(chartId);
            
            // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
            chart.innerHTML = '';
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
            for (let i = 0; i < denominator; i++) {
                const segment = document.createElement('div');
                segment.className = `segment ${i < numerator ? 'filled' : 'empty'}`;
                segment.title = `${i + 1}/${denominator}`;
                chart.appendChild(segment);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('incorrectCount').textContent = stats.incorrect;
            document.getElementById('streakCount').textContent = stats.streak;
            
            const successRate = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
            document.getElementById('progressBar').style.width = `${successRate}%`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
            updateLevelIndicator(successRate);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —É—Ä–æ–≤–Ω—è
        function updateLevelIndicator(successRate) {
            let level, levelText;
            
            if (successRate >= 90) {
                level = '–≠–∫—Å–ø–µ—Ä—Ç';
                levelText = '–≠–∫—Å–ø–µ—Ä—Ç';
            } else if (successRate >= 75) {
                level = '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π';
                levelText = '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π';
            } else if (successRate >= 60) {
                level = '–°—Ä–µ–¥–Ω–∏–π';
                levelText = '–°—Ä–µ–¥–Ω–∏–π';
            } else if (successRate >= 40) {
                level = '–ù–∞—á–∏–Ω–∞—é—â–∏–π';
                levelText = '–ù–∞—á–∏–Ω–∞—é—â–∏–π';
            } else {
                level = '–ù–æ–≤–∏—á–æ–∫';
                levelText = '–ù–æ–≤–∏—á–æ–∫';
            }
            
            document.getElementById('levelIndicator').textContent = `–£—Ä–æ–≤–µ–Ω—å: ${levelText}`;
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä–∏–∏
        function getSuccessMessage() {
            if (stats.streak === 1) {
                return '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ!';
            } else if (stats.streak === 3) {
                return '–û—Ç–ª–∏—á–Ω–æ! –£ –≤–∞—Å —Å–µ—Ä–∏—è –∏–∑ 3 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!';
            } else if (stats.streak === 5) {
                return '–ü–æ—Ç—Ä—è—Å–∞—é—â–µ! 5 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥—Ä—è–¥!';
            } else if (stats.streak === 10) {
                return '–§–µ–Ω–æ–º–µ–Ω–∞–ª—å–Ω–æ! –í—ã –º–∞—Å—Ç–µ—Ä —Å–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–±–µ–π!';
            } else {
                const messages = [
                    '–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!',
                    '–í–µ—Ä–Ω–æ! –í—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å!',
                    '–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç! –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!',
                    '–í–µ—Ä–Ω–æ! –í—ã —Ö–æ—Ä–æ—à–æ —Ä–∞–∑–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤ –¥—Ä–æ–±—è—Ö!'
                ];
                return messages[Math.floor(Math.random() * messages.length)];
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
            generateTask();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
            document.getElementById('checkButton').addEventListener('click', checkAnswer);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ"
            document.getElementById('nextButton').addEventListener('click', generateTask);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ (Enter)
            document.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    checkAnswer();
                }
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStats();
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.onload = initApp;
    </script>
</body>
</html>