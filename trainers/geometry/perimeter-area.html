<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–æ–º–µ—Ç—Ä–∏—è: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --danger: #dc2626;
            --bg: #f8fafc;
            --text: #1e293b;
        }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .main-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 30px;
            width: 100%;
            max-width: 650px;
            text-align: center;
        }

        /* Header */
        .level-badge {
            background: #e2e8f0; color: #475569;
            padding: 5px 12px; border-radius: 20px;
            font-size: 0.9em; font-weight: bold;
        }
        .progress-bar {
            height: 6px; background: #e2e8f0; border-radius: 3px;
            margin: 15px 0 20px 0; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--primary); width: 0%; transition: 0.3s;
        }

        /* Task Area */
        .task-box {
            background: #eff6ff;
            border-left: 5px solid var(--primary);
            padding: 20px;
            border-radius: 8px;
            text-align: left;
            margin-bottom: 25px;
        }
        .task-title { font-weight: bold; font-size: 1.1em; color: var(--primary); margin-bottom: 5px; }
        .task-desc { font-size: 1.1em; line-height: 1.5; }

        /* Canvas */
        .canvas-wrapper {
            display: flex; justify-content: center; margin-bottom: 15px;
        }
        .canvas-container {
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 2px solid #334155;
            border-radius: 2px;
            font-size: 0;
        }
        canvas {
            background-color: #fff;
            /* Grid 30px */
            background-image: 
                linear-gradient(#cbd5e1 1px, transparent 1px),
                linear-gradient(90deg, #cbd5e1 1px, transparent 1px);
            background-size: 30px 30px;
            cursor: crosshair;
            touch-action: none;
        }

        /* Minimal Stats (Ruler Only) */
        .ruler-stats {
            display: flex; justify-content: center; gap: 20px;
            margin-bottom: 20px; color: #64748b; font-family: monospace; font-size: 1.2em;
        }
        .ruler-val { color: #0f172a; font-weight: bold; }

        /* Controls */
        .feedback { min-height: 24px; font-weight: bold; margin-bottom: 15px; font-size: 1.1em; }
        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .btn:hover { background: #1d4ed8; transform: translateY(-1px); }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; transform: none; }
        .btn-reset { background: #64748b; margin-left: 10px; }
        .btn-reset:hover { background: #475569; }

        /* Floating Label */
        .cursor-label {
            position: absolute; pointer-events: none;
            background: rgba(15, 23, 42, 0.9); color: white;
            padding: 4px 8px; border-radius: 4px; font-size: 12px;
            display: none; z-index: 100;
        }
    </style>
<script src="../../assets/analytics.js"></script>
</head>
<body>

    <div class="main-card">
        <div>
            <span class="level-badge">–£—Ä–æ–≤–µ–Ω—å <span id="lvlNum">1</span> / 20</span>
            <div class="progress-bar"><div class="progress-fill" id="pFill"></div></div>
        </div>

        <div class="task-box">
            <div class="task-title" id="tTitle">–ó–∞–¥–∞–Ω–∏–µ</div>
            <div class="task-desc" id="tDesc">...</div>
        </div>

        <div class="canvas-wrapper">
            <div class="canvas-container">
                <canvas id="geoCanvas" width="300" height="300"></canvas>
                <div id="cursorLabel" class="cursor-label">0x0</div>
            </div>
        </div>

        <div class="ruler-stats">
            <span>–®–∏—Ä–∏–Ω–∞: <span id="sW" class="ruler-val">0</span></span>
            <span>–í—ã—Å–æ—Ç–∞: <span id="sH" class="ruler-val">0</span></span>
        </div>

        <div class="feedback" id="feedback"></div>

        <div>
            <button class="btn" id="btnCheck" onclick="checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <button class="btn btn-reset" onclick="resetDraw()">–°–±—Ä–æ—Å</button>
        </div>
    </div>

<script>
    /*
     LOGIC:
     - 300x300 canvas (10x10 cells).
     - "Base" rectangle is drawn in BLUE outline.
     - User draws in FILLED BLUE.
    */
    
    const levels = [
        // --- –ë–õ–û–ö 1: –ü–õ–û–©–ê–î–¨ –ò –ü–ï–†–ò–ú–ï–¢–† (–ë–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫) ---
        {
            t: "–û—Å–Ω–æ–≤—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è",
            d: "–ü–æ—Å—Ç—Ä–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ <b>4x6</b>. (–ü—Ä–æ–≤–µ—Ä—è–µ–º —É–º–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–µ—Ç–∫–æ–π).",
            check: (w,h,s,p) => (w===4 && h===6) || (w===6 && h===4)
        },
        {
            t: "–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞",
            d: "–ü–æ—Å—Ç—Ä–æ–π <b>–∫–≤–∞–¥—Ä–∞—Ç</b>, –ø–µ—Ä–∏–º–µ—Ç—Ä –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–≤–µ–Ω <b>16</b> –∫–ª–µ—Ç–∫–∞–º.",
            // P=16 -> Side=4.
            check: (w,h,s,p) => w===4 && h===4
        },
        {
            t: "–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–ª–æ—â–∞–¥–∏",
            d: "–ü–æ—Å—Ç—Ä–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –ø–ª–æ—â–∞–¥—å—é <b>24</b> –∫–ª–µ—Ç–∫–∏.",
            // Options: 3x8, 4x6, 2x12 (doesn't fit), etc.
            check: (w,h,s,p) => s===24
        },
        {
            t: "–û–±—Ä–∞—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞",
            d: "–ü–µ—Ä–∏–º–µ—Ç—Ä –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ <b>20</b>, –æ–¥–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ <b>3</b>. –ü–æ—Å—Ç—Ä–æ–π –µ–≥–æ.",
            // P=20 -> a+b=10. a=3 -> b=7. Build 3x7.
            check: (w,h,s,p) => (w===3 && h===7) || (w===7 && h===3)
        },
        {
            t: "–ö–≤–∞–¥—Ä–∞—Ç –ø–æ –ø–ª–æ—â–∞–¥–∏",
            d: "–ü–æ—Å—Ç—Ä–æ–π –∫–≤–∞–¥—Ä–∞—Ç, –ø–ª–æ—â–∞–¥—å –∫–æ—Ç–æ—Ä–æ–≥–æ <b>49</b> –∫–ª–µ—Ç–æ–∫.",
            check: (w,h,s,p) => w===7 && h===7
        },

        // --- –ë–õ–û–ö 2: –ü–†–û–¶–ï–ù–¢–´ (–†–ê–ó–ù–´–ï –ë–ê–ó–´) ---
        // base: {w, h} - defines the "Whole" (Blue Outline)
        {
            t: "–ë–∞–∑–∞ 5x4 (20 –∫–ª–µ—Ç–æ–∫)",
            base: {w:5, h:4},
            d: "–°–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä ‚Äî —ç—Ç–æ –ø–æ–ª–µ (100%). –ó–∞–∫—Ä–∞—Å—å <b>50%</b> —ç—Ç–æ–≥–æ –ø–æ–ª—è.",
            // Total=20. Target=10.
            check: (w,h,s,p) => s===10
        },
        {
            t: "–ë–∞–∑–∞ 10x2 (20 –∫–ª–µ—Ç–æ–∫)",
            base: {w:10, h:2},
            d: "–ü–æ–ª–µ ‚Äî —É–∑–∫–∞—è –ø–æ–ª–æ—Å–∫–∞ (—Å–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä). –ó–∞–∫—Ä–∞—Å—å <b>25%</b> —ç—Ç–æ–≥–æ –ø–æ–ª—è.",
            // Total=20. Target=5.
            check: (w,h,s,p) => s===5
        },
        {
            t: "–ë–∞–∑–∞ 5x10 (50 –∫–ª–µ—Ç–æ–∫)",
            base: {w:5, h:10},
            d: "–ü–æ–ª–µ ‚Äî 50 –∫–ª–µ—Ç–æ–∫. –ó–∞–∫—Ä–∞—Å—å <b>10%</b> —ç—Ç–æ–≥–æ –ø–æ–ª—è.",
            // Target=5.
            check: (w,h,s,p) => s===5
        },
        {
            t: "–ë–∞–∑–∞ 6x5 (30 –∫–ª–µ—Ç–æ–∫)",
            base: {w:6, h:5},
            d: "–ü–æ–ª–µ 30 –∫–ª–µ—Ç–æ–∫. –ó–∞–∫—Ä–∞—Å—å <b>20%</b> –ø–æ–ª—è –≤ –≤–∏–¥–µ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ <b>2x3</b>.",
            // Target=6. But specifically 2x3 dimensions asked? Text says "in shape of 2x3".
            // Let's allow any shape of area 6, but hints usually imply specific shape. Let's strict check.
            check: (w,h,s,p) => s===6 && ((w===2 && h===3)||(w===3 && h===2))
        },
        {
            t: "–ë–∞–∑–∞ 8x5 (40 –∫–ª–µ—Ç–æ–∫)",
            base: {w:8, h:5},
            d: "–ó–∞–∫—Ä–∞—Å—å <b>75%</b> —ç—Ç–æ–≥–æ –ø–æ–ª—è.",
            // 40 * 0.75 = 30.
            check: (w,h,s,p) => s===30
        },

        // --- –ë–õ–û–ö 3: –í–´–ß–ò–°–õ–ï–ù–ò–Ø –°–¢–û–†–û–ù –ò –ü–†–û–¶–ï–ù–¢–û–í ---
        {
            t: "–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –¥–ª–∏–Ω—ã",
            d: "–î–ª–∏–Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ <b>10</b>. –®–∏—Ä–∏–Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç <b>40%</b> –æ—Ç –¥–ª–∏–Ω—ã. –ü–æ—Å—Ç—Ä–æ–π –µ–≥–æ.",
            // w=10, h=4.
            check: (w,h,s,p) => (w===10 && h===4) || (w===4 && h===10)
        },
        {
            t: "–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω",
            d: "–®–∏—Ä–∏–Ω–∞ <b>6</b>. –í—ã—Å–æ—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç <b>50%</b> –æ—Ç —à–∏—Ä–∏–Ω—ã. –ü–æ—Å—Ç—Ä–æ–π —ç—Ç—É —Ñ–∏–≥—É—Ä—É.",
            // 6 and 3.
            check: (w,h,s,p) => (w===6 && h===3) || (w===3 && h===6)
        },
        {
            t: "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ",
            d: "–°—Ç–æ—Ä–æ–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç–∞ –±—ã–ª–∞ <b>4</b>. –ù–æ–≤—É—é —Å—Ç–æ—Ä–æ–Ω—É —É–≤–µ–ª–∏—á–∏–ª–∏ –Ω–∞ <b>50%</b>. –ü–æ—Å—Ç—Ä–æ–π –Ω–æ–≤—ã–π –∫–≤–∞–¥—Ä–∞—Ç.",
            // Old=4. 50%=2. New=6. Build 6x6.
            check: (w,h,s,p) => w===6 && h===6
        },
        {
            t: "–î–æ–ª–∏ –ø–ª–æ—â–∞–¥–∏",
            base: {w:10, h:10}, // Full field context
            d: "–ü–æ—Å—Ç—Ä–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫, –ø–ª–æ—â–∞–¥—å –∫–æ—Ç–æ—Ä–æ–≥–æ —Ä–∞–≤–Ω–∞ <b>12%</b> –æ—Ç –ø–æ–ª—è 10x10.",
            // S=12.
            check: (w,h,s,p) => s===12
        },

        // --- –ë–õ–û–ö 4: –≠–ö–°–ü–ï–†–¢ ---
        {
            t: "–°–ª–æ–∂–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç",
            base: {w:5, h:8}, // 40 cells
            d: "–ü–æ–ª–µ (—Å–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä) ‚Äî 40 –∫–ª–µ—Ç–æ–∫. –ü–æ—Å—Ç—Ä–æ–π —Ñ–∏–≥—É—Ä—É, —Ä–∞–≤–Ω—É—é <b>60%</b> –ø–æ–ª—è.",
            // 40*0.6 = 24.
            check: (w,h,s,p) => s===24
        },
        {
            t: "–ü–æ–ª–æ–≤–∏–Ω–∞ –æ—Ç –ø–æ–ª–æ–≤–∏–Ω—ã",
            base: {w:8, h:8}, // 64
            d: "–ü–æ–ª–µ 8x8. –ó–∞–∫—Ä–∞—Å—å <b>50%</b> –æ—Ç –µ–≥–æ <b>–ø–æ–ª–æ–≤–∏–Ω—ã</b>.",
            // 50% of 50% = 25%. 64 * 0.25 = 16.
            check: (w,h,s,p) => s===16
        },
        {
            t: "–ü–µ—Ä–∏–º–µ—Ç—Ä –∏ –ü–ª–æ—â–∞–¥—å",
            d: "–ü–æ—Å—Ç—Ä–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Å –ø–µ—Ä–∏–º–µ—Ç—Ä–æ–º <b>18</b> –∏ –ø–ª–æ—â–∞–¥—å—é <b>20</b>.",
            // Factors of 20: 4x5 -> P=(4+5)*2=18. Match.
            // 2x10 -> P=24.
            check: (w,h,s,p) => s===20 && p===18
        },
        {
            t: "–ü—Ä–æ—Ü–µ–Ω—Ç –∏ –ü–µ—Ä–∏–º–µ—Ç—Ä",
            base: {w:10, h:5}, // 50 cells
            d: "–ü–ª–æ—â–∞–¥—å —Ñ–∏–≥—É—Ä—ã —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç <b>36%</b> –æ—Ç –±–∞–∑—ã (50 –∫–ª). –ù–∞–π–¥–∏ –µ—ë —Å—Ç–æ—Ä–æ–Ω—ã, –µ—Å–ª–∏ –æ–¥–Ω–∞ –±–æ–ª—å—à–µ –¥—Ä—É–≥–æ–π –≤ 2 —Ä–∞–∑–∞.",
            // Target S = 50 * 0.36 = 18.
            // Sides a, b. a*b=18. a=2b. 2b*b=18 -> b^2=9 -> b=3. a=6.
            check: (w,h,s,p) => s===18 && ((w===3 && h===6)||(w===6 && h===3))
        },
        {
            t: "–§–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å",
            base: {w:10, h:8}, // –í–∏–∑—É–∞–ª—å–Ω–∞—è –±–∞–∑–∞ 80 –∫–ª–µ—Ç–æ–∫
            d: "–ë–∞–∑–∞ (—Å–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä) ‚Äî <b>80</b> –∫–ª–µ—Ç–æ–∫. –í—ã—á–∏—Å–ª–∏ <b>45%</b> –æ—Ç –±–∞–∑—ã. –ü–æ–ª—É—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ ‚Äî —ç—Ç–æ –ø–ª–æ—â–∞–¥—å <b>–ö–í–ê–î–†–ê–¢–ê</b>. –ü–æ—Å—Ç—Ä–æ–π –µ–≥–æ.",
            // –†–µ—à–µ–Ω–∏–µ: 80 * 0.45 = 36. –ö–≤–∞–¥—Ä–∞—Ç –ø–ª–æ—â–∞–¥–∏ 36 –∏–º–µ–µ—Ç —Å—Ç–æ—Ä–æ–Ω—É 6.
            check: (w,h,s,p) => s===36 && w===h
        },
        {
            t: "–ë–æ–Ω—É—Å: –ì—Ä–∞–Ω–¥-–º–∞—Å—Ç–µ—Ä",
            base: {w:10, h:8}, // –ë–∞–∑–∞ 80 –∫–ª–µ—Ç–æ–∫
            d: "–ë–∞–∑–∞ (—Å–∏–Ω–∏–π –∫–æ–Ω—Ç—É—Ä) ‚Äî <b>80</b> –∫–ª–µ—Ç–æ–∫. –ù–∞–π–¥–∏ <b>60%</b> –æ—Ç –±–∞–∑—ã.<br>–ü–æ—Å—Ç—Ä–æ–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ —Ç–∞–∫–æ–π –ø–ª–æ—â–∞–¥–∏, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–¥–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç <b>75%</b> –æ—Ç –¥—Ä—É–≥–æ–π.",
            // 1. S = 80 * 0.6 = 48.
            // 2. –°—Ç–æ—Ä–æ–Ω—ã a –∏ b. a = 0.75b.
            // 3. 0.75b * b = 48 -> b^2 = 64 -> b=8, a=6.
            check: (w,h,s,p) => s===48 && ((w===6 && h===8)||(w===8 && h===6))
        }
    ];

    // Engine
    const canvas = document.getElementById('geoCanvas');
    const ctx = canvas.getContext('2d');
    const CELL = 30;
    
    let curLvlIdx = 0;
    let isDraw = false;
    let start = {x:0, y:0};
    let sel = {x:0, y:0, w:0, h:0};

    // UI
    const uiLvl = document.getElementById('lvlNum');
    const uiFill = document.getElementById('pFill');
    const uiT = document.getElementById('tTitle');
    const uiD = document.getElementById('tDesc');
    const uiW = document.getElementById('sW');
    const uiH = document.getElementById('sH');
    const uiFb = document.getElementById('feedback');
    const uiLbl = document.getElementById('cursorLabel');
    const btnCheck = document.getElementById('btnCheck');

    function loadLevel() {
        if(curLvlIdx >= levels.length) {
            document.querySelector('.main-card').innerHTML = `
                <h2 style='color:var(--success)'>–ö—É—Ä—Å –ø—Ä–æ–π–¥–µ–Ω! üéì</h2>
                <p>–¢—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏.</p>
                <button class='btn' onclick='location.reload()'>–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>`;
            return;
        }
        const lvl = levels[curLvlIdx];
        uiLvl.textContent = curLvlIdx + 1;
        uiFill.style.width = ((curLvlIdx)/levels.length*100) + "%";
        uiT.textContent = lvl.t;
        uiD.innerHTML = lvl.d;
        uiFb.textContent = "";
        btnCheck.disabled = false;
        resetDraw();
    }

    // Input Handling
    function getCell(e) {
        const r = canvas.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: Math.floor((cx - r.left)/CELL),
            y: Math.floor((cy - r.top)/CELL)
        };
    }
    
    canvas.addEventListener('mousedown', startD);
    canvas.addEventListener('touchstart', e=>{e.preventDefault(); startD(e)}, {passive:false});
    window.addEventListener('mousemove', moveD);
    window.addEventListener('touchmove', moveD, {passive:false});
    window.addEventListener('mouseup', endD);
    window.addEventListener('touchend', endD);

    function startD(e) {
        isDraw = true;
        const c = getCell(e);
        start = {x: Math.max(0, Math.min(9, c.x)), y: Math.max(0, Math.min(9, c.y))};
        updSel(start.x, start.y);
    }
    function moveD(e) {
        if(!isDraw) return;
        const c = getCell(e);
        updSel(Math.max(0, Math.min(9, c.x)), Math.max(0, Math.min(9, c.y)), e);
    }
    function endD() { isDraw = false; uiLbl.style.display = 'none'; }

    function updSel(tx, ty, e) {
        const x = Math.min(start.x, tx);
        const y = Math.min(start.y, ty);
        const w = Math.abs(tx - start.x) + 1;
        const h = Math.abs(ty - start.y) + 1;
        sel = {x, y, w, h};
        draw();
        uiW.textContent = w;
        uiH.textContent = h;

        if(e) {
            const r = canvas.getBoundingClientRect();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            uiLbl.style.display = 'block';
            uiLbl.style.left = (cx - r.left + 15)+'px';
            uiLbl.style.top = (cy - r.top - 20)+'px';
            uiLbl.textContent = `${w}x${h}`;
        }
    }

    function draw() {
        ctx.clearRect(0,0,300,300);
        
        // Draw Base (if any)
        const lvl = levels[curLvlIdx];
        if(lvl.base) {
            ctx.strokeStyle = "#3b82f6"; // Blue Outline
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(0, 0, lvl.base.w * CELL, lvl.base.h * CELL);
            ctx.setLineDash([]);
            
            // Optional: Light highlight
            ctx.fillStyle = "rgba(59, 130, 246, 0.05)";
            ctx.fillRect(0, 0, lvl.base.w * CELL, lvl.base.h * CELL);
        }

        // Draw User Selection
        if(sel.w > 0) {
            ctx.fillStyle = "rgba(37, 99, 235, 0.5)"; // Darker blue
            ctx.fillRect(sel.x*CELL, sel.y*CELL, sel.w*CELL, sel.h*CELL);
            ctx.strokeStyle = "#1e3a8a";
            ctx.lineWidth = 2;
            ctx.strokeRect(sel.x*CELL, sel.y*CELL, sel.w*CELL, sel.h*CELL);
        }
    }

    function resetDraw() {
        sel = {x:0, y:0, w:0, h:0};
        uiW.textContent = 0; uiH.textContent = 0;
        draw();
        uiFb.textContent = "";
        btnCheck.disabled = false;
    }

    function checkAnswer() {
        if(sel.w === 0) { uiFb.innerHTML = "<span style='color:var(--danger)'>–ù–∞—Ä–∏—Å—É–π —á—Ç–æ-–Ω–∏–±—É–¥—å!</span>"; return; }
        
        const lvl = levels[curLvlIdx];
        const s = sel.w * sel.h;
        const p = (sel.w + sel.h) * 2;
        
        if(lvl.check(sel.w, sel.h, s, p)) {
            uiFb.innerHTML = "<span style='color:var(--success)'>–í–µ—Ä–Ω–æ! –ú–æ–ª–æ–¥–µ—Ü.</span>";
            btnCheck.disabled = true;
            setTimeout(() => {
                curLvlIdx++;
                loadLevel();
            }, 1000);
        } else {
            uiFb.innerHTML = "<span style='color:var(--danger)'>–û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è.</span>";
        }
    }

    loadLevel();

</script>
</body>

</html>
